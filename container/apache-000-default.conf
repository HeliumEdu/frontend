<VirtualHost *:3000>
    DocumentRoot /app

    ErrorLog /dev/stderr
    CustomLog /dev/stdout combined

    <Directory "/app">
      Require all granted

      RewriteEngine On
      RewriteBase /

      # Prepend www
      RewriteCond %{HTTP_HOST} !^localhost [NC]
      RewriteCond %{HTTP_HOST} !^www\. [NC]
      # Don't cause redirect for /info health checks
      RewriteCond %{REQUEST_URI} !^/info/?
      RewriteRule ^(.*)$ http://www.%{HTTP_HOST}/$1 [L,R=301,L,NC]

      # If URI does not include an extension, map it to a corresponding HTML or JSON file (if exists)
      RewriteCond %{REQUEST_FILENAME}.html -f
      RewriteCond %{REQUEST_FILENAME} !-d
      RewriteRule (.*) $1.html [L]
      RewriteCond %{REQUEST_FILENAME}.json -f
      RewriteCond %{REQUEST_FILENAME} !-d
      RewriteRule (.*) $1.json [L]

      ErrorDocument 404 /404.html
      ErrorDocument 500 /500.html
    </Directory>

    Alias "/info" "/app/assets/info.json"

    <Location "/info">
        ForceType application/json
    </Location>
</VirtualHost>
