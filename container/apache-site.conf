<VirtualHost *:80>
    DocumentRoot /app

    ErrorLog /dev/stderr
    CustomLog /dev/stdout combined

    # Serve static application
    <Directory "/app">
      Require all granted

      RewriteEngine On
      RewriteBase /

      RedirectMatch ^/planner$ /planner/calendar
      RedirectMatch ^/tour$ /
      RedirectMatch ^/prodigy$ /
      RedirectMatch ^/plans$ /

      RewriteRule ^(.*)/+$ $1 [R=301,L]

      RewriteCond %{REQUEST_FILENAME}.html -f
      RewriteCond %{REQUEST_FILENAME} !-d
      RewriteRule (.*) $1.html [L]

      ErrorDocument 404 /404.html
      ErrorDocument 500 /500.html
      ErrorDocument 503 /503.html
    </Directory>

    <Location /health>
        Require all denied
        Require ip 127.0.0.1
    </Location>

    # Redirect certain URLs through to the platform
    RewriteEngine On
    RewriteRule ^/status http:///%{HTTP_HOST}/status [R,L]
    RewriteRule ^/admin http:///%{HTTP_HOST}/admin [R,L]
    RewriteRule ^/docs http:///%{HTTP_HOST}/docs [R,L]
</VirtualHost>
